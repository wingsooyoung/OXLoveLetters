{#{%- for letter in exportSubmissions["/pages/writeletters/"] -%}#}
{#    <li class="testingES">#}
{#        <h3>{{ letter.nickname }}</h3>#}
{#        <div class="comment-text1">{{ letter.message | safe }}</div>#}
{#        <div class="comment-text2">{{ letter.signature }}</div>#}
{#    </li>#}
{#{% else %}#}
{#    <p class="testingES">{{ previews }}</p>#}
{#{%- endfor -%}#}

{%- for letter in exportSubmissions["/pages/writeletters/"] -%}
    <div class="containerbox grid-item {{ loop.index0 }}">
        <img src="/assets/postcard%20handdrawn%201.svg" alt="" id="postcard">
        <div id="contentbox" class="template">{{ letter.message | safe }}</div>
        <div id="namebox" class="template">
            {% if letter.signature %}
                {{ letter.nickname }}
            {% else %}
                FOR X
            {% endif %}
        </div>
        <div id="memberbox">{{ letter.member }}</div>
{#        change the member thing so it assigns the correct postcard based on whatever member is chosen!         #}
    </div>

    <button class="{{ loop.index0 }}" form="approver" id="approveL" type="submit">Approve</button>
{% else %}

    <li>No new letter submissions.</li>

{%- endfor -%}



<form id="approver" name="approved-letters" netlify netlify-honeypot="full-name">
    <input type="text" name="path">
    <input type="text" name="signature" id="signature">
    <input type="text" name="nickname" id="nickname">
    <textarea name="lettercontent" id="lettercontent"></textarea>
    <select id="members" name="members"></select>
</form>


<script>
    const handleSubmit = (event) => {
        event.preventDefault();
        let ele = event.submitter;
        const indexNumber = ele.className;
        let dex = CSS.escape(indexNumber);

        const myForm = event.target;
        const formData = new FormData(myForm);

        let message = document.querySelector(`#griddy > div.containerbox.grid-item.${CSS.escape(indexNumber)} > #contentbox`).innerHTML;
        let name = document.querySelector(`#griddy > div.containerbox.grid-item.${CSS.escape(indexNumber)} > #namebox`).innerHTML;
        let member = document.querySelector(`#griddy > div.containerbox.grid-item.${CSS.escape(indexNumber)} > #memberbox`).innerHTML;

        //manually enter form data
        formData.set('path', 'default');
        formData.set('signature','bool');
        formData.set('nickname', name); //figure out how to get it to NAME or FOR X
        formData.set('lettercontent', message);
        formData.set('members', member);

        //send data above to the READ page
        fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formData).toString(),
        })
            .then(() => alert("Thank you for your submission"))
            .catch((error) => alert(error));
    };

    document
        .querySelector("form")
        .addEventListener("submit", handleSubmit);

</script>




